## EJ 15
```c
void imprimir_habilitado(const char *nombre_usuario, const char* clave,
    const char * imprimir, int tam_imprimir) {
    char *cmd = malloc(tam_imprimir+5 * sizeof(char));
    if (cmd == NULL)
        exit(1);

    if (usuario_habilitado("/etc/shadow", nombre_usuario, clave)) {
        snprintf(cmd, tam_imprimir+4, "echo %s", imprimir);
        system(cmd);
    } else {
        printf("El usuario o clave indicados son incorrectos.");
        assert(-1);
    }
}
```

### 1)
EL programa debe correr con setuid activado para poder leer el archivo `/etc/shadow` y ejecutar `system()`, ya que necesita permisos de root

### 2) y 3)
Hay varios problemas de seguridad

#### Code Injection
En `snprintf` un atacante podria ingresar `"'hola'; rm -rf /"`, lo que haria que `system(cmd)` ejecute:
```bash
echo "hola"; rm -rf /
```

Tambien podria ingresas `"'hola'; cat /etc/shadow"` lo que haria que `system(cmd)` ejecute:
```bash
echo "hola"; cat /etc/shadow
```
Exponiendo asi contenido sensible del sistema.

#### Environment Variable Attack
Como se usan rutas relativas y no absolutas, un atacante podria modificar la variable de entorno `PATH` para que `echo` ejecute binario malicioso. Luego, al llamar a `system("echo ...")` se ejecutaria el binario malicioso en lugar del `echo` original. 


#### Brute Force DoS
Al no hacer `free()` de `cmd`, se genera una fuga de memoria. Un atacante podria aprovechar esto para hacer un ataque de denegacion de servicio (DoS) mediante un ataque de fuerza bruta, enviando muchas peticiones y llenando la memoria del sistema.


### 4)
Los 3 requisitos fundamentales de Seguridad de la Informacion son:
- Confidencialidad
- Integridad
- Disponibilidad

El ``Code Injection``y ``Environment Variable Attack`` impactan la Confidencialidad e Integridad, ya que permiten a un atacante ejecutar codigo arbitrario, acceder a informacion sensible y modificar datos.

El ``Brute Force DoS`` impacta la Disponibilidad, ya que puede agotar los recursos del sistema y hacer que el servicio no esté disponible para usuarios legítimos.


### 5)
#### Code Injection
Para mitigar esta vulnerabilidad se deberia sanitizar el input del usuario, evitando caracteres especiales como `;`, `&`, `|`, etc. 
Tambien se podria usar funciones que no involucren la ejecucion de comandos del sistema, como `printf` en lugar de `system("echo ...")`.

#### Environment Variable Attack
Se deberian usar rutas absolutas para los comandos, por ejemplo `system("/bin/echo ...")`, para evitar que se ejecute un binario malicioso.

#### Brute Force DoS
Se deberia liberar la memoria asignada a `cmd` usando `free(cmd)` antes de salir de la funcion.
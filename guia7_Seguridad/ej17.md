## EJ 17
```c
char MAX_SIZE = 127;
unsigned char buffer[128];
char *format = "%s %d %s\n";

char* algo_asi_si(char *cadena){
    scanf("%127s", buffer);
    printf(format, buffer, MAX_SIZE, cadena);
    return cadena;
}

char* algo_asi_no(char *cadena){
    if(strlen(cadena) > MAX_SIZE) exit(EXIT_FAILURE);
    sprintf(buffer, format, "echo" , atoi(cadena), "asi si?\n");
    system(buffer);
    return cadena;
}

int main(int argc, char **argv){
    setuid(0);
    printf(algo_asi_no(algo_asi_si(argv[1])));
}
```

### Explicación del código
El codigo corre con permisos de root, ya que ejecuta `setuid(0);` al inicio del `main`.  
Recibe un argumento en ``argv[1]`` y ejecuta `printf(algo_asi_no(algo_asi_si(argv[1])));`.  

``char* algo_asi_si(char *cadena)`` recibe la cadena pasada por parametro por el usuario y le pide otra cadena de maximo 127 caracteres, guardandola en `buffer`.  
Finalmente printea `"buffer 127 cadena"` y devuelve `cadena`.

``char* algo_asi_no(char *cadena)`` recibe la cadena pasada por parametro por el usuario y verifica que su largo no supere 127 caracteres, sino termina con error.  
Luego escribe en el buffer ``"echo N asi si?\n"`` siendo ``N = atoi(cadena)``, para finalmente ejecutar el comando con `system(buffer);` y retornar `cadena`.

`main` termina imprimiendo el resultado de `algo_asi_no(algo_asi_si(argv[1]))`, que es simplemente `argv[1]`.

### Vulnerabilidades de seguridad
#### Format String Attack en ``main``
Dado que el printf en `main` no tiene parametro de formato, si el usuario ingresa caracteres de formato en `argv[1]`, puede leer valores de la pila.
Por ejemplo, si el usuario ingresa `"%x %x %x %x"`, el programa imprimira 4 valores de la pila, pudiendo filtrar informacion sensible.

#### Environment Variable Attack en ``algo_asi_no``
Al usar variables relativas, un atacante podria modificar la variable de entorno `PATH` para ejecutar un binario malicioso en lugar del comando `echo`.


### Impacto del ataque
- ``Confidencialidad``: Un atacante puede leer valores de la pila mediante el ``format string attack``, pudiendo filtrar información sensible del sistema. Tambien podria ejecutar un binario malicioso con permisos de root para leer archivos sensibles, por ejemplo ejecutando ``cat /etc/shadow``.
- ``Integridad``: Un atacante puede modificar la variable de entorno `PATH` para ejecutar binarios maliciosos con permisos de root, permitiendo asi por ejemplo ejecutar ``echo "usuario:clave" >> /etc/passwd`` y agregar usuarios al sistema.
- ``Disponibilidad``: Un atacante podria ejecutar binarios maliciosos que rompan el sistema, por ejemplo `rm -rf /`.
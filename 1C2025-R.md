## EJ 2: Drivers
```c
// VARIABLES GLOBALES:
Mutex mtxUsr       // Para proteger contador
int Luces[5]       // Guarda el id del proceso que tiene cada luz
int contador 
int prendidas     
// Pq mutex y contador en vez de semaforo de 5?
// Pide que si un 6to se intenta conectar falle, no que se quede esperando.
// El semaforo de 5 tendria sentido si se quiere que el 6to quede esperando hasta que se libere un lugar. 

// INTERFAZ DRIVER:
- init/destroy
- read/write
- open/close


// REGISTROS:
- NUM_LED
- STATUS_LED
- RTSA_SEÑAL


init( ...  ){
    contador = 0
    mtxUser.init(1)
    for(i = 0...4){
        luces[i] = -1   // -1 = libre
    }
}

destroy( ...  ){
    // destruir todo
}

open(void* data; int s; int id){
    mtxUSr.wait()   
    // Seccion critica
    if (contador < 5){
        // Entra solo si hay un lugar libre
        int i = 0
        while(linea[i] != -1) {i++}
        contador++ 
        luces[i] = ID
        mtxUsr.signal()
        return IO_OK     
    } else {
        mtxUsr.signal()
        return ERROR
    }
}


close(void* data; int s; int id){
    int i = 0
    while(linea[i] != id) {i++}
    mtxUSr.wait()
    // Seccion critica
    luces[i] = -1
    contador--
    mtxUsr.signal()
    }

// s = size
read(void* data; int s; int id){
    copy_to_user(data, IN(RTSA_SEÑAL), s)
    return s        // Por convencion cuando un usuario lee espera recibir cuanto leyó
}


// Data será 0 o 1 dependiendo si quiere apagar o prender la luz
write(void* data; int s; int id){
    int infoLed
    copy_from_user(&infoLed, data, sizeof(infoLed))
    int i = 0
    while (luces[i] != id){ i++ }

    mtxUsr.wait()
    // Seccion critica
    OUT(NUM_LED, i)
    OUT(STATUS_LED, 0)   // Apagar luz

    // Caso usuario prende luz
    if (infoLed){
        OUT(STATUS_LED, 1)   // Prender luz
        if(++prendidas == 3){
            OUT(NUM_LED, 6)
            OUT(STATUS_LED, 1)   // Prender 6ta luz
        }
    // Caso usuario apaga luz
    } else {
        // La luz ya la apagamos arriba
        if(--prendidas == 2){
            OUT(NUM_LED, 6)
            OUT(STATUS_LED, 0)   // Apagar 6ta luz
        }
    }

    mtxUsr.signal()
    return s
}